<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text and Image Layout Generator</title>
  <style>
    /* Import custom font */
    @font-face {
      font-family: 'URWGroteskWid-Lig';
      src: url('URWGroteskWid-Lig.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    /* Center the main heading */
    h1 {
      text-align: center;
      margin: 20px 0;
      font-family: 'URWGroteskWid-Lig', sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      overflow-x: auto;
    }

    .content-area {
      width: 1800px;
      height: 920px;
      margin: 0 auto;
      position: relative;
      border: 1px solid #ccc;
      overflow: hidden;
      background-color: #fff;
      box-sizing: border-box;
      padding: 50px; /* 大容器四周50px padding */
    }

    .layout-container {
      width: 1700px; /* 1800 - 50*2 = 1700 */
      height: 820px; /* 920 - 50*2 = 820 */
      box-sizing: border-box;
      display: flex;
      gap: 100px; /* 左右容器间隔100px */
    }

    .left-container,
    .right-container {
      width: 800px; /* (1700 - 100) / 2 = 800px */
      height: 820px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      /* 添加灰色虚线边框，不占空间 */
      border: 1px dashed #ccc;
      position: relative;
    }

    /* 居中对齐 */
    .left-container {
      justify-content: center;
      align-items: center;
    }

    .right-container {
      justify-content: center;
      align-items: center;
    }

    .image-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .image-placeholder {
      width: 800px;
      height: 460px;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      color: #999;
    }

    .image-placeholder.small {
      width: 370px;
      height: 370px;
    }

    .text-area {
      width: 800px;
      font-family: 'URWGroteskWid-Lig', sans-serif;
      font-size: 41px;
      font-weight: normal;
      line-height: 50px;
      letter-spacing: 0px;
      word-wrap: break-word;
    }

    /* 段落基础样式 */
    .paragraph {
      font-family: 'URWGroteskWid-Lig', sans-serif;
      font-size: 41px;
      font-weight: normal;
      line-height: 50px;
      letter-spacing: 0px;
      word-wrap: break-word;
      width: 100%;
      margin-bottom: 30px;
    }

    .paragraph:last-child {
      margin-bottom: 0;
    }

    .control-panel {
      width: 1800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f5f5f5;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .row {
      display: flex;
      gap: 20px;
    }

    .column {
      flex: 1;
    }

    textarea {
      width: 100%;
      height: 400px;
      padding: 10px;
      box-sizing: border-box;
      font-size: 16px;
      line-height: 1.5;
      font-family: monospace;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }

    #generateBtn {
      background-color: #165DFF;
      color: white;
    }

    #generateBtn:hover {
      background-color: #0E42CC;
    }

    .checkbox-group {
      margin-bottom: 20px;
    }

    /* Hidden measurement container - for accurate text height calculation */
    #measureContainer {
      position: absolute;
      visibility: hidden;
      width: 800px;
      font-family: 'URWGroteskWid-Lig', sans-serif;
      font-size: 41px;
      line-height: 50px;
      word-wrap: break-word;
      top: -1000px;
    }

    #measureContainer .paragraph {
      font-family: 'URWGroteskWid-Lig', sans-serif;
      font-size: 41px;
      font-weight: normal;
      line-height: 50px;
      letter-spacing: 0px;
      word-wrap: break-word;
      margin-bottom: 30px;
    }

    #measureContainer .paragraph:last-child {
      margin-bottom: 0;
    }
    
    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* 超出指示器 */
    .overflow-indicator {
      position: absolute;
      bottom: -25px;
      left: 0;
      width: 100%;
      text-align: center;
      color: #ff4d4f;
      font-size: 16px;
      font-family: sans-serif;
    }
    
    /* 内容包装器 - 用于居中内容 */
    .content-wrapper {
      width: 100%;
      max-height: 100%;
      overflow: hidden;
      position: relative;
    }
    
    /* 文本容器 - 用于控制文本溢出 */
    .text-container {
      width: 100%;
      position: relative;
    }
    
    /* 溢出容器样式 */
    .overflow-container {
      justify-content: flex-start !important;
    }
  </style>
</head>

<body>
  <h1>Text and Image Layout Generator</h1>

  <!-- Display area -->
  <div class="content-area">
    <div id="layoutDisplay" class="layout-container">
      Please enter text and click "Generate Layout" to view the result
    </div>
  </div>

  <!-- Control panel -->
  <div class="control-panel">
    <div class="row">
      <div class="column">
        <label for="textInput">Enter Text</label><br>
        <textarea id="textInput" placeholder="Enter text content. Paragraphs will be automatically separated by line breaks">but the nest was small. It was too little for everyone.
Mother Bird looked at her children. "It's time for you to fly," she said.
Sister Bird stood up and looked down.
"You can do it," said Mother Bird.
"Yes, I can." Sister Bird said quietly. Then she jumped out of the nest and fell.
Mother Bird and Little Bird looked around. "There is also!" they wondered.
Suddenly, they saw her flying up in the sky, singing a happy song. Mother Bird smiled.
Next, it was Little Bird's turn, but she was scared. She looked down at the ground.

"No, I can't," she said quietly. Little tears rolled down her cheeks.

"Don't worry," said Mother Bird. "You are a bird. Birds can fly."

Little Bird closed her eyes and jumped. She fell a long way, and then she opened her eyes. She was flying with Sister Bird.</textarea>
      </div>
      <div class="column">
        <div class="checkbox-group">
          <label>
            <input type="checkbox" id="hasImage" checked> Include Image
          </label>
        </div>
        <div class="checkbox-group" id="imageSizeGroup">
          <label>
            <input type="checkbox" id="useSmallImage"> Use small image
          </label>
        </div>
        <button id="generateBtn">
          <span id="buttonText">Generate Layout</span>
          <span id="loadingIndicator" class="loading" style="display:none;"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Hidden measurement container - key for accurate text height calculation -->
  <div id="measureContainer"></div>

  <script>
    // Initialize page
    document.addEventListener('DOMContentLoaded', function () {
      // Set fixed zoom to 33%
      document.body.style.zoom = "33%";

      // Get DOM elements
      const generateBtn = document.getElementById('generateBtn');
      const textInput = document.getElementById('textInput');
      const hasImage = document.getElementById('hasImage');
      const useSmallImage = document.getElementById('useSmallImage');
      const imageSizeGroup = document.getElementById('imageSizeGroup');
      const layoutDisplay = document.getElementById('layoutDisplay');
      const measureContainer = document.getElementById('measureContainer');
      const buttonText = document.getElementById('buttonText');
      const loadingIndicator = document.getElementById('loadingIndicator');
      
      // Track font loading state
      let fontLoaded = false;
      
      // Check if custom font is available
      function checkFontLoaded() {
        // Create test elements
        const testElement = document.createElement('span');
        testElement.style.position = 'absolute';
        testElement.style.visibility = 'hidden';
        testElement.style.fontFamily = 'sans-serif';
        testElement.style.fontSize = '20px';
        testElement.textContent = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        
        const referenceElement = testElement.cloneNode(true);
        referenceElement.style.fontFamily = 'URWGroteskWid-Lig, sans-serif';
        
        document.body.appendChild(testElement);
        document.body.appendChild(referenceElement);
        
        // If widths are different, font is loaded
        const isLoaded = testElement.offsetWidth !== referenceElement.offsetWidth;
        
        // Clean up
        document.body.removeChild(testElement);
        document.body.removeChild(referenceElement);
        
        return isLoaded;
      }
      
      // Wait for font to load with timeout
      function waitForFontLoad() {
        return new Promise((resolve) => {
          // Check immediately
          if (checkFontLoaded()) {
            fontLoaded = true;
            resolve(true);
            return;
          }
          
          // Check periodically
          const interval = setInterval(() => {
            if (checkFontLoaded()) {
              clearInterval(interval);
              fontLoaded = true;
              resolve(true);
            }
          }, 100);
          
          // Timeout after 3 seconds
          setTimeout(() => {
            clearInterval(interval);
            console.warn('Font did not load within 3 seconds, using fallback');
            resolve(false);
            fontLoaded = true; // 强制设置为已加载，即使字体未加载也继续
          }, 3000);
        });
      }

      // Toggle image size option visibility based on include image checkbox
      hasImage.addEventListener('change', function () {
        imageSizeGroup.style.display = this.checked ? 'block' : 'none';
      });

      // Bind generate button event
      generateBtn.addEventListener('click', async function() {
        // Show loading state
        buttonText.textContent = 'Generating...';
        loadingIndicator.style.display = 'inline-block';
        generateBtn.disabled = true;
        
        try {
          // Ensure font is loaded before generating layout
          if (!fontLoaded) {
            await waitForFontLoad();
          }
          generateLayout();
        } finally {
          // Restore button state
          buttonText.textContent = 'Generate Layout';
          loadingIndicator.style.display = 'none';
          generateBtn.disabled = false;
        }
      });

      // Main layout generation function
      function generateLayout() {
        // Get input text and split into paragraphs
        const text = textInput.value.trim();
        if (!text) {
          layoutDisplay.innerHTML = 'Please enter text content';
          return;
        }

        // Split paragraphs by line breaks and clean up
        const paragraphs = text.split(/\n+/)
          .filter(para => para.trim() !== '')
          .map(para => para.replace(/^- /, '').trim()); // Remove bullet points if present

        // Calculate layout type
        const layout = calculateLayout(paragraphs, hasImage.checked, useSmallImage.checked);

        // Render layout
        renderLayout(layout);
      }

      // Accurately measure text height
      function measureTextHeight(paragraphs) {
        // Set text to measurement container
        measureContainer.innerHTML = '';

        // Create paragraph container
        const container = document.createElement('div');
        container.className = 'text-area';

        // Add all paragraphs
        paragraphs.forEach((para, index) => {
          const paraElement = document.createElement('div');
          paraElement.className = 'paragraph';
          paraElement.textContent = para;
          container.appendChild(paraElement);
        });

        measureContainer.appendChild(container);
        
        // Force reflow before measuring
        container.offsetHeight; // Trigger reflow
        
        // Get actual rendered height
        const height = container.offsetHeight;
        return height;
      }

      // Calculate layout type
      function calculateLayout(paragraphs, hasImage, useSmallImage) {
        // No image or no paragraphs case
        if (!hasImage || paragraphs.length === 0) {
          const midPoint = Math.ceil(paragraphs.length / 2);
          return {
            type: 'no_image',
            left_paras: paragraphs.slice(0, midPoint),
            right_paras: paragraphs.slice(midPoint),
            useSmallImage: false
          };
        }

        // Determine image dimensions based on selection
        const imageHeight = useSmallImage ? 370 : 460;
        const imageGap = 20;
        const leftAvailableHeight = 820 - imageHeight - imageGap; 

        // Try to distribute paragraphs to left and right
        const leftParas = [];
        const rightParas = [...paragraphs]; // Start with all paragraphs on right

        // Try to put first paragraph
        leftParas.push(paragraphs[0]);
        rightParas.shift(); // Remove from right
        let currentHeight = measureTextHeight(leftParas);

        // If first paragraph can't fit, use image only on left layout
        if (currentHeight > leftAvailableHeight) {
          return {
            type: 'image_only',
            left_paras: null,
            right_paras: paragraphs,
            useSmallImage: useSmallImage
          };
        }

        // Try to add more paragraphs to left
        while (rightParas.length > 0) {
          const nextPara = rightParas[0];
          const tempParas = [...leftParas, nextPara];
          const tempHeight = measureTextHeight(tempParas);

          if (tempHeight <= leftAvailableHeight) {
            leftParas.push(nextPara);
            rightParas.shift();
            currentHeight = tempHeight;
          } else {
            break; // Stop if next paragraph doesn't fit
          }
        }

        // If all paragraphs fit on left
        if (rightParas.length === 0) {
          // Consider balancing left and right
          const midPoint = Math.ceil(leftParas.length / 2);
          return {
            type: 'image_with_text',
            left_paras: leftParas.slice(0, midPoint),
            right_paras: leftParas.slice(midPoint),
            useSmallImage: useSmallImage
          };
        }

        // Left with image + text, right with text layout
        return {
          type: 'image_with_text',
          left_paras: leftParas,
          right_paras: rightParas,
          useSmallImage: useSmallImage
        };
      }

      // Render paragraph elements
      function renderParagraphs(paragraphs, containerHeight, isOverflow = false) {
        if (!paragraphs || paragraphs.length === 0) return null;

        const container = document.createElement('div');
        container.className = 'text-container';

        paragraphs.forEach(para => {
          const paraElement = document.createElement('div');
          paraElement.className = 'paragraph';
          paraElement.textContent = para;
          container.appendChild(paraElement);
        });

        // Check if content overflows
        const contentHeight = container.scrollHeight;
        if (contentHeight > containerHeight && isOverflow) {
          const indicator = document.createElement('div');
          indicator.className = 'overflow-indicator';
          indicator.textContent = 'Content exceeds container';
          container.appendChild(indicator);
        }

        return container;
      }

      // Render layout
      function renderLayout(layout) {
        // Create main container
        const container = document.createElement('div');
        container.className = 'layout-container';

        // Determine image class based on size
        const imageClass = layout.useSmallImage ? 'image-placeholder small' : 'image-placeholder';

        switch (layout.type) {
          case 'no_image':
            // No image layout: text split into two columns
            const leftContainer1 = document.createElement('div');
            leftContainer1.className = 'left-container';
            
            const leftWrapper1 = document.createElement('div');
            leftWrapper1.className = 'content-wrapper';
            leftWrapper1.appendChild(renderParagraphs(layout.left_paras, 820, true));
            leftContainer1.appendChild(leftWrapper1);

            const rightContainer1 = document.createElement('div');
            rightContainer1.className = 'right-container';
            
            const rightWrapper1 = document.createElement('div');
            rightWrapper1.className = 'content-wrapper';
            rightWrapper1.appendChild(renderParagraphs(layout.right_paras, 820, true));
            rightContainer1.appendChild(rightWrapper1);

            container.appendChild(leftContainer1);
            container.appendChild(rightContainer1);
            break;

          case 'image_only':
            // Image on left, text on right layout
            const leftContainer2 = document.createElement('div');
            leftContainer2.className = 'left-container';
            
            const leftWrapper2 = document.createElement('div');
            leftWrapper2.className = 'content-wrapper';
            
            // Create image container for centering
            const imageContainer2 = document.createElement('div');
            imageContainer2.className = 'image-container';
            imageContainer2.innerHTML = `<div class="${imageClass}">image</div>`;
            
            leftWrapper2.appendChild(imageContainer2);
            leftContainer2.appendChild(leftWrapper2);

            const rightContainer2 = document.createElement('div');
            rightContainer2.className = 'right-container';
            
            const rightWrapper2 = document.createElement('div');
            rightWrapper2.className = 'content-wrapper';
            rightWrapper2.appendChild(renderParagraphs(layout.right_paras, 820, true));
            rightContainer2.appendChild(rightWrapper2);

            container.appendChild(leftContainer2);
            container.appendChild(rightContainer2);
            break;

          case 'image_with_text':
            // Image + text on left, text on right layout
            const leftContainer3 = document.createElement('div');
            leftContainer3.className = 'left-container';
            
            const leftWrapper3 = document.createElement('div');
            leftWrapper3.className = 'content-wrapper';
            
            // Create image container for centering
            const imageContainer3 = document.createElement('div');
            imageContainer3.className = 'image-container';
            imageContainer3.innerHTML = `<div class="${imageClass}">image</div>`;
            
            leftWrapper3.appendChild(imageContainer3);
            
            // Add text content if available
            if (layout.left_paras && layout.left_paras.length > 0) {
              const textHeight = 820 - (layout.useSmallImage ? 370 : 460) - 20;
              leftWrapper3.appendChild(renderParagraphs(layout.left_paras, textHeight, true));
            }
            
            leftContainer3.appendChild(leftWrapper3);

            const rightContainer3 = document.createElement('div');
            rightContainer3.className = 'right-container';
            
            const rightWrapper3 = document.createElement('div');
            rightWrapper3.className = 'content-wrapper';
            rightWrapper3.appendChild(renderParagraphs(layout.right_paras, 820, true));
            rightContainer3.appendChild(rightWrapper3);

            container.appendChild(leftContainer3);
            container.appendChild(rightContainer3);
            break;
        }

        // Update display area
        layoutDisplay.innerHTML = '';
        layoutDisplay.appendChild(container);
        
        // 检查是否需要调整对齐方式
        adjustAlignment();
      }
      
      // 调整对齐方式
      function adjustAlignment() {
        const leftContainers = document.querySelectorAll('.left-container');
        const rightContainers = document.querySelectorAll('.right-container');
        
        leftContainers.forEach(container => {
          const wrapper = container.querySelector('.content-wrapper');
          if (wrapper && wrapper.scrollHeight <= 820) {
            // 内容未超出，保持居中
            container.style.justifyContent = 'center';
          } else {
            // 内容超出，顶部对齐
            container.style.justifyContent = 'flex-start';
          }
        });
        
        rightContainers.forEach(container => {
          const wrapper = container.querySelector('.content-wrapper');
          if (wrapper && wrapper.scrollHeight <= 820) {
            // 内容未超出，保持居中
            container.style.justifyContent = 'center';
          } else {
            // 内容超出，顶部对齐
            container.style.justifyContent = 'flex-start';
          }
        });
      }
      
      // Generate initial layout on page load
      generateBtn.click();
    });
  </script>
</body>

</html>
